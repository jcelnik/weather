<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Roboto Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto">

    <!-- AlpineJS -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                fontFamily: {
                    sans: ["Roboto", "sans-serif"],
                },
                extend: {
                    colors: {
                        primary: '#042247'
                    }
                }
            },
        };
    </script>

    <title>Tahoe Weather</title>
</head>

<body class="bg-slate-100">
    <div class="flex flex-col md:flex-row md:flex-wrap">
        <section id="cameras" class="w-full md:w-1/2 lg:w-2/3 xl:w-1/2 md:p-2">
            <div class="bg-white rounded-sm shadow">
                <div class="uppercase font-bold pt-2 pl-2 text-center w-full md:text-left">Cameras</div>
                <div class="grid grid-cols-1 sm:grid-cols-2" x-data="{
            cameras: [
                        { name: 'Whitmore Grade (154)', url: 'https://cwwp2.dot.ca.gov/data/d3/cctv/image/hwy80atwhitmoregrade/hwy80atwhitmoregrade.jpg' },
                        { name: 'Kingvale EB (171)', url: 'https://cwwp2.dot.ca.gov/data/d3/cctv/image/hwy80atkingvaleeb/hwy80atkingvaleeb.jpg' },
                        { name: 'Kingvale WB (171)', url: 'https://cwwp2.dot.ca.gov/data/d3/cctv/image/hwy80atkingvalewb/hwy80atkingvalewb.jpg' },
                        { name: 'Soda Springs EB (174)', url: 'https://cwwp2.dot.ca.gov/data/d3/cctv/image/hwy80atsodaspringseb/hwy80atsodaspringseb.jpg' },
                        { name: 'Soda Springs WB (174)', url: 'https://cwwp2.dot.ca.gov/data/d3/cctv/image/hwy80atsodaspringseb/hwy80atsodaspringseb.jpg' },
                        { name: 'Castle Peak (176)', url: 'https://cwwp2.dot.ca.gov/data/d3/cctv/image/hwy80atcastlepeak/hwy80atcastlepeak.jpg' },
                        { name: 'Donner Summit (176)', url: 'https://cwwp2.dot.ca.gov/data/d3/cctv/image/hwy80atdonnersummit/hwy80atdonnersummit.jpg' },
                        { name: 'Donner Lake (180)', url: 'https://cwwp2.dot.ca.gov/data/d3/cctv/image/hwy80atdonnerlake/hwy80atdonnerlake.jpg' },
                        { name: 'Truckee Interchange (184)', url: 'https://cwwp2.dot.ca.gov/data/d3/cctv/image/hwy80atoldagsta/hwy80atoldagsta.jpg' }
                    ]
                }">
                    <template x-for="camera in cameras">
                        <div class="text-xs w-full p-2 flex flex-col items-center">
                            <span class="text-sm font-bold" x-text="camera.name"></span>
                            <img :src="camera.url">
                        </div>
                    </template>
                </div>
            </div>
        </section>
        <section id="chain-controls" class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 md:p-2 mt-4 md:mt-0">
            <div class="bg-white rounded-sm shadow">
                <div class="uppercase font-bold pt-2 pl-2 text-center w-full md:text-left">Chain Controls - I-80</div>
                <div class="w-full p-2 text-xs" x-data="chainControls()" x-init="init()">
                    <div x-show="loading" class="text-center py-4 text-gray-500">Loading...</div>
                    <div x-show="error" class="text-center py-4 text-red-500" x-text="error"></div>
                    <div x-show="!loading && !error" class="divide-y">
                        <template x-for="cc in controls" :key="cc.index">
                            <div class="py-2">
                                <div class="flex justify-between items-start">
                                    <span class="font-bold" x-text="cc.location"></span>
                                    <span class="px-2 py-0.5 rounded text-white text-xs"
                                        :class="cc.status === 'R-0' ? 'bg-green-500' : 'bg-red-500'"
                                        x-text="cc.status"></span>
                                </div>
                                <div class="text-gray-600 mt-1" x-text="cc.description"></div>
                                <div class="text-gray-400 mt-1" x-text="cc.direction + ' - ' + cc.elevation + ' ft'"></div>
                            </div>
                        </template>
                    </div>
                    <div x-show="!loading && !error && controls.length === 0" class="text-center py-4 text-gray-500">
                        No chain control data available
                    </div>
                    <div x-show="!loading && !error" class="text-gray-400 text-center mt-2 pt-2 border-t" x-text="'Updated: ' + lastUpdate"></div>
                </div>
            </div>
        </section>
        <section id="links" class="w-full lg:w-2/3 xl:w-1/4 md:p-2 mt-4 lg:mt-0">
            <div class="bg-white rounded-sm shadow">
                <div class="uppercase font-bold pt-2 pl-2 text-center w-full md:text-left">Updates</div>
                <div class="p-4 space-y-3">
                    <a href="https://x.com/CaltransDist3" target="_blank" class="flex items-center p-3 bg-slate-50 rounded hover:bg-slate-100 transition">
                        <span class="text-2xl mr-3">üöß</span>
                        <div>
                            <div class="font-bold text-sm">Caltrans District 3</div>
                            <div class="text-xs text-gray-500">@CaltransDist3</div>
                        </div>
                    </a>
                    <a href="https://x.com/CHP_Truckee" target="_blank" class="flex items-center p-3 bg-slate-50 rounded hover:bg-slate-100 transition">
                        <span class="text-2xl mr-3">üöî</span>
                        <div>
                            <div class="font-bold text-sm">CHP Truckee</div>
                            <div class="text-xs text-gray-500">@CHP_Truckee</div>
                        </div>
                    </a>
                    <a href="https://x.com/NWSReno" target="_blank" class="flex items-center p-3 bg-slate-50 rounded hover:bg-slate-100 transition">
                        <span class="text-2xl mr-3">üå®Ô∏è</span>
                        <div>
                            <div class="font-bold text-sm">NWS Reno</div>
                            <div class="text-xs text-gray-500">@NWSReno</div>
                        </div>
                    </a>
                    <a href="https://roads.dot.ca.gov/" target="_blank" class="flex items-center p-3 bg-slate-50 rounded hover:bg-slate-100 transition">
                        <span class="text-2xl mr-3">üõ£Ô∏è</span>
                        <div>
                            <div class="font-bold text-sm">QuickMap</div>
                            <div class="text-xs text-gray-500">Caltrans Road Conditions</div>
                        </div>
                    </a>
                </div>
            </div>
        </section>
    </div>

    <script>
        function chainControls() {
            return {
                controls: [],
                loading: true,
                error: null,
                lastUpdate: '',

                async init() {
                    try {
                        const response = await fetch('https://cwwp2.dot.ca.gov/data/d3/cc/ccStatusD03.json');
                        if (!response.ok) throw new Error('Failed to fetch data');
                        const data = await response.json();

                        // Filter for I-80 (route 80) and sort by postmile
                        this.controls = data.data
                            .filter(item => item.cc.location.route === '80')
                            .map(item => ({
                                index: item.cc.index,
                                location: item.cc.location.locationName,
                                direction: item.cc.location.direction === 'E' ? 'Eastbound' : 'Westbound',
                                elevation: item.cc.location.elevation,
                                status: item.cc.statusData.status,
                                description: item.cc.statusData.statusDescription,
                                postmile: parseFloat(item.cc.location.postmile)
                            }))
                            .sort((a, b) => a.postmile - b.postmile);

                        if (data.data.length > 0) {
                            const ts = data.data[0].cc.statusData.statusTimestamp;
                            this.lastUpdate = new Date(ts.statusDate + ' ' + ts.statusTime).toLocaleString();
                        }
                    } catch (e) {
                        this.error = 'Could not load chain controls: ' + e.message;
                    }
                    this.loading = false;
                }
            }
        }
    </script>
</body>

</html>